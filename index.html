<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#3b82f6">
  <meta name="description" content="ä¼ä¸šå¼€æ”¯ç®¡ç†ç³»ç»Ÿ - è·Ÿè¸ªå’Œç®¡ç†æ‚¨çš„ä¼ä¸šæ”¯å‡º">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ä¼ä¸šå¼€æ”¯">
  <title>ä¼ä¸šå¼€æ”¯ç®¡ç†ç³»ç»Ÿ</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

    const PlusCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
      </svg>
    );

    const TrendingDown = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/>
      </svg>
    );

    const DollarSign = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
      </svg>
    );

    const Calendar = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );

    const Trash2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    );

    const Download = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );

    const ExpenseTracker = () => {
      const [expenses, setExpenses] = useState(() => {
        try {
          const saved = localStorage.getItem('expenses');
          return saved ? JSON.parse(saved) : [];
        } catch {
          return [];
        }
      });
      
      const [formData, setFormData] = useState({
        description: '',
        amount: '',
        category: 'åŠå…¬ç”¨å“',
        date: new Date().toISOString().split('T')[0]
      });
      
      const [filter, setFilter] = useState('all');

      useEffect(() => {
        try {
          localStorage.setItem('expenses', JSON.stringify(expenses));
        } catch (e) {
          console.error('ä¿å­˜å¤±è´¥:', e);
        }
      }, [expenses]);

      const categories = ['åŠå…¬ç”¨å“', 'å·®æ—…è´¹', 'å·¥èµ„', 'ç§Ÿé‡‘', 'å¸‚åœºè¥é”€', 'è®¾å¤‡é‡‡è´­', 'åŸ¹è®­', 'æ‹›å¾…è´¹', 'å…¶ä»–'];

      const categoryColors = {
        'åŠå…¬ç”¨å“': '#3b82f6', 'å·®æ—…è´¹': '#8b5cf6', 'å·¥èµ„': '#ec4899', 'ç§Ÿé‡‘': '#f59e0b',
        'å¸‚åœºè¥é”€': '#10b981', 'è®¾å¤‡é‡‡è´­': '#6366f1', 'åŸ¹è®­': '#14b8a6', 'æ‹›å¾…è´¹': '#f97316', 'å…¶ä»–': '#64748b'
      };

      const handleSubmit = () => {
        if (formData.description && formData.amount) {
          const newExpense = { id: Date.now(), ...formData, amount: parseFloat(formData.amount) };
          setExpenses([newExpense, ...expenses]);
          setFormData({ description: '', amount: '', category: 'åŠå…¬ç”¨å“', date: new Date().toISOString().split('T')[0] });
        }
      };

      const deleteExpense = (id) => setExpenses(expenses.filter(exp => exp.id !== id));
      const filteredExpenses = filter === 'all' ? expenses : expenses.filter(exp => exp.category === filter);
      const totalExpense = filteredExpenses.reduce((sum, exp) => sum + exp.amount, 0);

      const categoryStats = categories.map(cat => ({
        name: cat,
        value: expenses.filter(exp => exp.category === cat).reduce((sum, exp) => sum + exp.amount, 0)
      })).filter(stat => stat.value > 0);

      const monthlyStats = expenses.reduce((acc, exp) => {
        const month = exp.date.substring(0, 7);
        if (!acc[month]) acc[month] = 0;
        acc[month] += exp.amount;
        return acc;
      }, {});

      const monthlyData = Object.entries(monthlyStats)
        .map(([month, amount]) => ({ month, amount }))
        .sort((a, b) => a.month.localeCompare(b.month))
        .slice(-6);

      const exportToCSV = () => {
        const headers = ['æ—¥æœŸ', 'æè¿°', 'ç±»åˆ«', 'é‡‘é¢'];
        const rows = filteredExpenses.map(exp => [exp.date, exp.description, exp.category, exp.amount]);
        const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
        const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `ä¼ä¸šå¼€æ”¯_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-8">
          <div className="max-w-7xl mx-auto">
            <div className="mb-8">
              <h1 className="text-4xl font-bold text-slate-800 mb-2">ä¼ä¸šå¼€æ”¯ç®¡ç†ç³»ç»Ÿ</h1>
              <p className="text-slate-600">è·Ÿè¸ªå’Œç®¡ç†æ‚¨çš„ä¼ä¸šæ”¯å‡º ğŸ“±</p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
              <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-600 text-sm mb-1">æ€»å¼€æ”¯</p>
                    <p className="text-3xl font-bold text-slate-800">Â¥{totalExpense.toLocaleString('zh-CN', {minimumFractionDigits: 2})}</p>
                  </div>
                  <div className="bg-blue-100 p-3 rounded-lg"><DollarSign size={32} /></div>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-600 text-sm mb-1">å¼€æ”¯ç¬”æ•°</p>
                    <p className="text-3xl font-bold text-slate-800">{filteredExpenses.length}</p>
                  </div>
                  <div className="bg-purple-100 p-3 rounded-lg"><TrendingDown size={32} /></div>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-600 text-sm mb-1">å¹³å‡å¼€æ”¯</p>
                    <p className="text-3xl font-bold text-slate-800">
                      Â¥{filteredExpenses.length > 0 ? (totalExpense / filteredExpenses.length).toLocaleString('zh-CN', {minimumFractionDigits: 2}) : '0.00'}
                    </p>
                  </div>
                  <div className="bg-green-100 p-3 rounded-lg"><Calendar size={32} /></div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-xl font-bold text-slate-800 mb-4">æ·»åŠ å¼€æ”¯</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">æè¿°</label>
                    <input type="text" value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="ä¾‹å¦‚ï¼šè´­ä¹°åŠå…¬æ¡Œæ¤…" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">é‡‘é¢ï¼ˆÂ¥ï¼‰</label>
                      <input type="number" step="0.01" value={formData.amount} onChange={(e) => setFormData({...formData, amount: e.target.value})}
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0.00" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">æ—¥æœŸ</label>
                      <input type="date" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})}
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">ç±»åˆ«</label>
                    <select value={formData.category} onChange={(e) => setFormData({...formData, category: e.target.value})}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                      {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                    </select>
                  </div>
                  <button onClick={handleSubmit}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2 transition-colors">
                    <PlusCircle size={20} /> æ·»åŠ å¼€æ”¯
                  </button>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-xl font-bold text-slate-800 mb-4">åˆ†ç±»ç»Ÿè®¡</h2>
                {categoryStats.length > 0 ? (
                  <ResponsiveContainer width="100%" height={300}>
                    <PieChart>
                      <Pie data={categoryStats} cx="50%" cy="50%" labelLine={false}
                        label={({name, percent}) => `${name} ${(percent * 100).toFixed(0)}%`}
                        outerRadius={80} dataKey="value">
                        {categoryStats.map((entry, i) => <Cell key={`cell-${i}`} fill={categoryColors[entry.name]} />)}
                      </Pie>
                      <Tooltip formatter={(value) => `Â¥${value.toLocaleString('zh-CN', {minimumFractionDigits: 2})}`} />
                    </PieChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="h-72 flex items-center justify-center text-slate-400">æš‚æ— æ•°æ®</div>
                )}
              </div>
            </div>

            {monthlyData.length > 0 && (
              <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 className="text-xl font-bold text-slate-800 mb-4">æœˆåº¦è¶‹åŠ¿</h2>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={monthlyData}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis />
                    <Tooltip formatter={(value) => `Â¥${value.toLocaleString('zh-CN', {minimumFractionDigits: 2})}`} />
                    <Legend />
                    <Bar dataKey="amount" fill="#3b82f6" name="å¼€æ”¯é‡‘é¢" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}

            <div className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                <h2 className="text-xl font-bold text-slate-800">å¼€æ”¯è®°å½•</h2>
                <div className="flex gap-2 w-full sm:w-auto">
                  <select value={filter} onChange={(e) => setFilter(e.target.value)}
                    className="flex-1 sm:flex-none px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="all">å…¨éƒ¨ç±»åˆ«</option>
                    {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                  </select>
                  {filteredExpenses.length > 0 && (
                    <button onClick={exportToCSV}
                      className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-2 transition-colors">
                      <Download size={18} /> å¯¼å‡º
                    </button>
                  )}
                </div>
              </div>

              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-slate-200">
                      <th className="text-left py-3 px-4 text-slate-600 font-semibold">æ—¥æœŸ</th>
                      <th className="text-left py-3 px-4 text-slate-600 font-semibold">æè¿°</th>
                      <th className="text-left py-3 px-4 text-slate-600 font-semibold">ç±»åˆ«</th>
                      <th className="text-right py-3 px-4 text-slate-600 font-semibold">é‡‘é¢</th>
                      <th className="text-center py-3 px-4 text-slate-600 font-semibold">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredExpenses.length > 0 ? (
                      filteredExpenses.map(expense => (
                        <tr key={expense.id} className="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                          <td className="py-3 px-4 text-slate-700">{expense.date}</td>
                          <td className="py-3 px-4 text-slate-700">{expense.description}</td>
                          <td className="py-3 px-4">
                            <span className="px-3 py-1 rounded-full text-sm font-medium text-white"
                              style={{backgroundColor: categoryColors[expense.category]}}>
                              {expense.category}
                            </span>
                          </td>
                          <td className="py-3 px-4 text-right font-semibold text-slate-800">
                            Â¥{expense.amount.toLocaleString('zh-CN', {minimumFractionDigits: 2})}
                          </td>
                          <td className="py-3 px-4 text-center">
                            <button onClick={() => deleteExpense(expense.id)}
                              className="text-red-600 hover:text-red-800 transition-colors">
                              <Trash2 size={18} />
                            </button>
                          </td>
                        </tr>
                      ))
                    ) : (
                      <tr><td colSpan="5" className="py-8 text-center text-slate-400">æš‚æ— å¼€æ”¯è®°å½•</td></tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<ExpenseTracker />, document.getElementById('root'));
  </script>
</body>
</html>
